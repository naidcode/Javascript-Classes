<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Todo App - OOP</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .main-grid {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 20px;
    }

    .sidebar {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      height: fit-content;
    }

    .sidebar h2 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.3rem;
    }

    .category-form {
      margin-bottom: 20px;
    }

    .category-form input {
      width: 100%;
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      margin-bottom: 10px;
      font-size: 0.95rem;
    }

    .color-picker {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .color-option {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      cursor: pointer;
      border: 3px solid transparent;
      transition: transform 0.2s;
    }

    .color-option:hover {
      transform: scale(1.1);
    }

    .color-option.selected {
      border-color: #333;
      transform: scale(1.15);
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
      width: 100%;
    }

    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .categories-list {
      margin-top: 20px;
    }

    .category-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      margin-bottom: 8px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .category-item:hover {
      transform: translateX(5px);
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }

    .category-item.active {
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
      transform: translateX(5px);
    }

    .category-info {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
    }

    .category-color {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .category-count {
      background: #f0f0f0;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .btn-delete {
      background: #ff6b6b;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.8rem;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .category-item:hover .btn-delete {
      opacity: 1;
    }

    .main-content {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .stat-number {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .todo-form {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr;
      gap: 10px;
      margin-bottom: 10px;
    }

    .todo-form input,
    .todo-form select,
    .todo-form textarea {
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 0.95rem;
      font-family: inherit;
    }

    .todo-form textarea {
      grid-column: 1 / -1;
      resize: vertical;
      min-height: 60px;
    }

    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .filter-group {
      display: flex;
      gap: 5px;
    }

    .filter-btn {
      padding: 8px 16px;
      border: 2px solid #e0e0e0;
      background: white;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
    }

    .filter-btn:hover {
      border-color: #667eea;
      color: #667eea;
    }

    .filter-btn.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .search-box {
      flex: 1;
      min-width: 250px;
    }

    .search-box input {
      width: 100%;
      padding: 10px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 20px;
      font-size: 0.95rem;
    }

    .todos-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .todo-item {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 15px;
      display: flex;
      align-items: center;
      gap: 15px;
      transition: all 0.3s;
    }

    .todo-item:hover {
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }

    .todo-item.completed {
      opacity: 0.6;
      background: #f8f9fa;
    }

    .todo-checkbox {
      width: 24px;
      height: 24px;
      cursor: pointer;
    }

    .todo-content {
      flex: 1;
    }

    .todo-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .todo-item.completed .todo-title {
      text-decoration: line-through;
    }

    .todo-description {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 8px;
    }

    .todo-meta {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .priority-high {
      background: #ffe0e0;
      color: #d32f2f;
    }

    .priority-medium {
      background: #fff4e0;
      color: #f57c00;
    }

    .priority-low {
      background: #e0f7fa;
      color: #0097a7;
    }

    .badge-overdue {
      background: #ffebee;
      color: #c62828;
    }

    .badge-date {
      background: #f0f0f0;
      color: #666;
    }

    .btn-delete-todo {
      background: #ff6b6b;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
    }

    .btn-delete-todo:hover {
      background: #ff5252;
      transform: scale(1.05);
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 20px;
    }

    @media (max-width: 1024px) {
      .main-grid {
        grid-template-columns: 1fr;
      }

      .stats {
        grid-template-columns: repeat(2, 1fr);
      }

      .form-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>📋 Todo App - OOP Version</h1>
      <p>Built with Classes and Object-Oriented Programming</p>
    </header>

    <div class="main-grid">
      <aside class="sidebar">
        <h2>Categories</h2>
        <div class="category-form">
          <input type="text" id="categoryName" placeholder="New category name" maxlength="20">
          <div class="color-picker" id="colorPicker"></div>
          <button class="btn btn-primary" id="addCategoryBtn">Add Category</button>
        </div>
        <div class="categories-list" id="categoriesList"></div>
      </aside>

      <main class="main-content">
        <div class="stats" id="stats"></div>

        <div class="todo-form">
          <div class="form-row">
            <input type="text" id="todoTitle" placeholder="What needs to be done?" maxlength="100">
            <select id="todoCategory">
              <option value="">Select Category</option>
            </select>
            <select id="todoPriority">
              <option value="low">Low Priority</option>
              <option value="medium" selected>Medium Priority</option>
              <option value="high">High Priority</option>
            </select>
            <input type="date" id="todoDueDate">
          </div>
          <textarea id="todoDescription" placeholder="Description (optional)"></textarea>
          <button class="btn btn-primary" id="addTodoBtn">Add Todo</button>
        </div>

        <div class="filters">
          <div class="filter-group">
            <button class="filter-btn active" data-status="all">All</button>
            <button class="filter-btn" data-status="active">Active</button>
            <button class="filter-btn" data-status="completed">Completed</button>
          </div>
          <div class="filter-group">
            <button class="filter-btn" data-priority="high">High Priority</button>
            <button class="filter-btn" data-priority="medium">Medium Priority</button>
            <button class="filter-btn" data-priority="low">Low Priority</button>
          </div>
          <div class="search-box">
            <input type="text" id="searchInput" placeholder="🔍 Search todos...">
          </div>
        </div>

        <div class="todos-list" id="todosList"></div>
      </main>
    </div>
  </div>

  <script>
    // Category Class - Represents one category
    class Category {
      constructor(name, color) {
        this.id = Date.now() + Math.random();
        this.name = name;
        this.color = color;
      }
    }

    // Todo Class - Represents one todo
    class Todo {
      constructor(data) {
        this.id = Date.now() + Math.random();
        this.title = data.title;
        this.description = data.description || '';
        this.categoryId = data.categoryId;
        this.priority = data.priority || 'medium';
        this.dueDate = data.dueDate || null;
        this.completed = false;
        this.createdAt = new Date().toISOString();
      }

      toggleComplete() {
        this.completed = !this.completed;
      }

      isOverdue() {
        if (!this.dueDate || this.completed) return false;
        return new Date() > new Date(this.dueDate);
      }
    }

    // TodoManager Class - Business Logic
    class TodoManager {
      constructor() {
        this.categories = [];
        this.todos = [];
        this.loadFromStorage();
        
        if (this.categories.length === 0) {
          this.addCategory('Personal', '#667eea');
          this.addCategory('Work', '#f093fb');
          this.addCategory('Shopping', '#4facfe');
        }
      }

      addCategory(name, color) {
        const category = new Category(name, color);
        this.categories.push(category);
        this.saveToStorage();
        return category;
      }

      deleteCategory(id) {
        this.categories = this.categories.filter(c => c.id !== id);
        this.todos = this.todos.filter(t => t.categoryId !== id);
        this.saveToStorage();
      }

      getCategoryById(id) {
        return this.categories.find(c => c.id === id);
      }

      getTodoCountForCategory(categoryId) {
        return this.todos.filter(t => t.categoryId === categoryId).length;
      }

      addTodo(data) {
        const todo = new Todo(data);
        this.todos.push(todo);
        this.saveToStorage();
        return todo;
      }

      deleteTodo(id) {
        this.todos = this.todos.filter(t => t.id !== id);
        this.saveToStorage();
      }

      toggleTodo(id) {
        const todo = this.todos.find(t => t.id === id);
        if (todo) {
          todo.toggleComplete();
          this.saveToStorage();
        }
      }

      getFilteredTodos(filters) {
        let result = [...this.todos];

        if (filters.category) {
          result = result.filter(t => t.categoryId === filters.category);
        }

        if (filters.priority) {
          result = result.filter(t => t.priority === filters.priority);
        }

        if (filters.status === 'active') {
          result = result.filter(t => !t.completed);
        } else if (filters.status === 'completed') {
          result = result.filter(t => t.completed);
        }

        if (filters.search) {
          const searchLower = filters.search.toLowerCase();
          result = result.filter(t => 
            t.title.toLowerCase().includes(searchLower) ||
            t.description.toLowerCase().includes(searchLower)
          );
        }

        return result;
      }

      getStatistics() {
        const total = this.todos.length;
        const completed = this.todos.filter(t => t.completed).length;
        const active = total - completed;
        const overdue = this.todos.filter(t => {
          if (!t.dueDate || t.completed) return false;
          return new Date() > new Date(t.dueDate);
        }).length;

        return { total, completed, active, overdue };
      }

      saveToStorage() {
        localStorage.setItem('todoAppOOP', JSON.stringify({
          categories: this.categories,
          todos: this.todos
        }));
      }

      loadFromStorage() {
        const saved = localStorage.getItem('todoAppOOP');
        if (saved) {
          const data = JSON.parse(saved);
          this.categories = data.categories || [];
          this.todos = data.todos || [];
        }
      }
    }

    // UIRenderer Class - Display Logic
    class UIRenderer {
      constructor(manager) {
        this.manager = manager;
        this.colors = ['#667eea', '#f093fb', '#4facfe', '#43e97b', '#fa709a', '#fee140', '#30cfd0'];
        this.selectedColor = this.colors[0];
      }

      renderColorPicker() {
        const picker = document.getElementById('colorPicker');
        picker.innerHTML = this.colors.map(color => `
          <div class="color-option ${color === this.selectedColor ? 'selected' : ''}" 
               style="background: ${color}" 
               data-color="${color}"></div>
        `).join('');
      }

      renderCategories(activeId = null) {
        const list = document.getElementById('categoriesList');
        const select = document.getElementById('todoCategory');

        list.innerHTML = this.manager.categories.map(cat => `
          <div class="category-item ${activeId === cat.id ? 'active' : ''}" 
               style="background: ${cat.color}20; border-left: 4px solid ${cat.color}"
               data-id="${cat.id}">
            <div class="category-info">
              <div class="category-color" style="background: ${cat.color}"></div>
              <span>${cat.name}</span>
              <span class="category-count">${this.manager.getTodoCountForCategory(cat.id)}</span>
            </div>
            <button class="btn-delete" data-id="${cat.id}">Delete</button>
          </div>
        `).join('');

        select.innerHTML = '<option value="">Select Category</option>' + 
          this.manager.categories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('');
      }

      renderStatistics() {
        const stats = this.manager.getStatistics();
        document.getElementById('stats').innerHTML = `
          <div class="stat-card">
            <div class="stat-number">${stats.total}</div>
            <div class="stat-label">Total Tasks</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${stats.active}</div>
            <div class="stat-label">Active</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${stats.completed}</div>
            <div class="stat-label">Completed</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${stats.overdue}</div>
            <div class="stat-label">Overdue</div>
          </div>
        `;
      }

      renderTodos(filters) {
        const list = document.getElementById('todosList');
        const todos = this.manager.getFilteredTodos(filters);

        if (todos.length === 0) {
          list.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">📝</div>
              <h3>No tasks found</h3>
              <p>Create your first task or adjust your filters</p>
            </div>
          `;
          return;
        }

        list.innerHTML = todos.map(todo => {
          const category = this.manager.getCategoryById(todo.categoryId);
          const overdue = todo.dueDate && !todo.completed && new Date() > new Date(todo.dueDate);

          return `
            <div class="todo-item ${todo.completed ? 'completed' : ''}" 
                 style="border-left: 4px solid ${category ? category.color : '#ccc'}">
              <input type="checkbox" class="todo-checkbox" 
                     ${todo.completed ? 'checked' : ''} 
                     data-id="${todo.id}">
              <div class="todo-content">
                <div class="todo-title">${todo.title}</div>
                ${todo.description ? `<div class="todo-description">${todo.description}</div>` : ''}
                <div class="todo-meta">
                  ${category ? `<span class="badge" style="background: ${category.color}20; color: ${category.color}">${category.name}</span>` : ''}
                  <span class="badge priority-${todo.priority}">${todo.priority.toUpperCase()}</span>
                  ${todo.dueDate ? `<span class="badge ${overdue ? 'badge-overdue' : 'badge-date'}">${overdue ? '⚠️ ' : '📅 '}${new Date(todo.dueDate).toLocaleDateString()}</span>` : ''}
                </div>
              </div>
              <button class="btn-delete-todo" data-id="${todo.id}">Delete</button>
            </div>
          `;
        }).join('');
      }

      renderAll(filters, activeCategoryId = null) {
        this.renderColorPicker();
        this.renderCategories(activeCategoryId);
        this.renderStatistics();
        this.renderTodos(filters);
      }
    }

    // App Class - Main Controller
    class App {
      constructor() {
        this.manager = new TodoManager();
        this.renderer = new UIRenderer(this.manager);
        this.filters = {
          category: null,
          priority: null,
          status: 'all',
          search: ''
        };
        
        this.init();
      }

      init() {
        this.setupEventListeners();
        this.renderer.renderAll(this.filters);
      }

      debounce(func, delay) {
        let timeoutId;
        return (...args) => {
          clearTimeout(timeoutId);
          timeoutId = setTimeout(() => func.apply(this, args), delay);
        };
      }

      setupEventListeners() {
        // Color picker
        document.getElementById('colorPicker').addEventListener('click', (e) => {
          if (e.target.classList.contains('color-option')) {
            this.renderer.selectedColor = e.target.dataset.color;
            this.renderer.renderColorPicker();
          }
        });

        // Add category
        document.getElementById('addCategoryBtn').addEventListener('click', () => {
          const nameInput = document.getElementById('categoryName');
          const name = nameInput.value.trim();
          if (name) {
            this.manager.addCategory(name, this.renderer.selectedColor);
            nameInput.value = '';
            this.renderer.renderAll(this.filters, this.filters.category);
          }
        });

        // Category actions
        document.getElementById('categoriesList').addEventListener('click', (e) => {
          const deleteBtn = e.target.closest('.btn-delete');
          if (deleteBtn) {
            e.stopPropagation();
            const id = parseFloat(deleteBtn.dataset.id);
            if (confirm('Delete this category and all its todos?')) {
              this.manager.deleteCategory(id);
              if (this.filters.category === id) this.filters.category = null;
              this.renderer.renderAll(this.filters);
            }
          } else {
            const categoryItem = e.target.closest('.category-item');
            if (categoryItem) {
              const id = parseFloat(categoryItem.dataset.id);
              this.filters.category = this.filters.category === id ? null : id;
              this.renderer.renderAll(this.filters, this.filters.category);
            }
          }
        });

        // Add todo
        document.getElementById('addTodoBtn').addEventListener('click', () => {
          const title = document.getElementById('todoTitle').value.trim();
          const categoryId = parseFloat(document.getElementById('todoCategory').value);
          const priority = document.getElementById('todoPriority').value;
          const dueDate = document.getElementById('todoDueDate').value;
          const description = document.getElementById('todoDescription').value.trim();

          if (title && categoryId) {
            this.manager.addTodo({ title, categoryId, priority, dueDate, description });
            document.getElementById('todoTitle').value = '';
            document.getElementById('todoDescription').value = '';
            document.getElementById('todoDueDate').value = '';
            this.renderer.renderAll(this.filters, this.filters.category);
          } else {
            alert('Please enter a title and select a category!');
          }
        });

        // Todo actions
        document.getElementById('todosList').addEventListener('click', (e) => {
          if (e.target.classList.contains('todo-checkbox')) {
            const id = parseFloat(e.target.dataset.id);
            this.manager.toggleTodo(id);
            this.renderer.renderAll(this.filters, this.filters.category);
          } else if (e.target.classList.contains('btn-delete-todo')) {
            const id = parseFloat(e.target.dataset.id);
            this.manager.deleteTodo(id);
            this.renderer.renderAll(this.filters, this.filters.category);
          }
        });

        // Status filters
        document.querySelectorAll('[data-status]').forEach(btn => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('[data-status]').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            this.filters.status = btn.dataset.status;
            this.renderer.renderTodos(this.filters);
          });
        });

        // Priority filters
        document.querySelectorAll('[data-priority]').forEach(btn => {
          btn.addEventListener('click', () => {
            if (this.filters.priority === btn.dataset.priority) {
              this.filters.priority = null;
              btn.classList.remove('active');
            } else {
              document.querySelectorAll('[data-priority]').forEach(b => b.classList.remove('active'));
              btn.classList.add('active');
              this.filters.priority = btn.dataset.priority;
            }
            this.renderer.renderTodos(this.filters);
          });
        });

        // Search with debounce
        const debouncedSearch = this.debounce((searchTerm) => {
          this.filters.search = searchTerm;
          this.renderer.renderTodos(this.filters);
        }, 300);

        document.getElementById('searchInput').addEventListener('input', (e) => {
          debouncedSearch(e.target.value);
        });
      }
    }

    // Start the app
    const app = new App();
  </script>
</body>
</html>